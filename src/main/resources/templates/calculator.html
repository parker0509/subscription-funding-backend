<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비타민 분석기</title>
    <!-- Tesseract.js v1.0.10 CDN 추가 -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@1.0.10/dist/tesseract.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            text-align: center;
        }
        .container {
            width: 80%;
            margin: 0 auto;
            padding-top: 50px;
        }
        .upload-section {
            margin-bottom: 30px;
        }
        .result {
            margin-top: 30px;
            padding: 20px;
            background-color: #f4f4f4;
            border-radius: 8px;
        }
        .result h3 {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>비타민 분석기</h1>

    <!-- 이미지 업로드 영역 -->
    <div class="upload-section">
        <input type="file" class="form-control" id="vitaminImage" accept="image/*" onchange="handleImageUpload(event)">
    </div>

    <!-- 분석 결과 표시 영역 -->
    <div id="analysisResult" class="result" style="display:none;">
        <h3>분석 결과</h3>
        <p id="vitaminA"></p>
        <p id="vitaminB"></p>
        <p id="vitaminC"></p>
    </div>
</div>

<script>
    // 이미지 업로드 후 분석 시작
    function handleImageUpload(event) {
        const imageFile = event.target.files[0];
        if (imageFile) {
            extractTextFromImage(imageFile);
        }
    }

    // Tesseract.js v1.0.10을 사용하여 이미지에서 텍스트 추출
// Tesseract.js v1.0.10을 사용하여 이미지에서 텍스트 추출
function extractTextFromImage(image) {
    const reader = new FileReader();

    reader.onload = function(event) {
        const imgElement = new Image();
        imgElement.src = event.target.result;

        imgElement.onload = function() {
            // 한국어와 영어를 동시에 추출하기 위해 'kor+eng' 사용
            Tesseract.recognize(
                imgElement, // 이미지 객체
                'eng', // 한국어와 영어 언어 설정
                {
                    logger: m => console.log(m) // 진행 상태를 콘솔에 출력
                }
            ).then(({ data: { text } }) => {
                console.log('추출된 텍스트: ', text);
                // 텍스트 분석
                processExtractedText(text);
            }).catch(error => {
                console.error('OCR 오류:', error);
            });
        };
    };

    reader.readAsDataURL(image);
}

    // 추출된 텍스트 분석 후 비타민 정보 추출
    function processExtractedText(text) {
        console.log('추출된 텍스트:', text);

        // 분석 결과 표시
        document.getElementById('analysisResult').style.display = 'block';

        // 추출된 텍스트에서 비타민 A, B, C 값을 정규 표현식으로 추출
        let vitamins = extractVitaminsFromText(text);

        // 결과 표시
        displayVitaminResults(vitamins);
    }

    // 텍스트에서 비타민 정보 추출 (정규 표현식 사용)
    function extractVitaminsFromText(text) {
        let vitamins = {};

        // 비타민 A
        let vitaminAAmount = text.match(/비타민 A\s*(\d+)\s*(mg|㎎)/);
        if (vitaminAAmount) {
            vitamins['A'] = parseInt(vitaminAAmount[1]);
        }

        // 비타민 B
        let vitaminBAmount = text.match(/비타민 B\s*(\d+)\s*(mg|㎎)/);
        if (vitaminBAmount) {
            vitamins['B'] = parseInt(vitaminBAmount[1]);
        }

        // 비타민 C
        let vitaminCAmount = text.match(/비타민 C\s*(\d+)\s*(mg|㎎)/);
        if (vitaminCAmount) {
            vitamins['C'] = parseInt(vitaminCAmount[1]);
        }

        return vitamins;
    }

    // 비타민 분석 결과를 화면에 표시
    function displayVitaminResults(vitamins) {
        let vitaminA = vitamins['A'] ? `비타민 A: ${vitamins['A']}mg` : '비타민 A 정보 없음';
        let vitaminB = vitamins['B'] ? `비타민 B: ${vitamins['B']}mg` : '비타민 B 정보 없음';
        let vitaminC = vitamins['C'] ? `비타민 C: ${vitamins['C']}mg` : '비타민 C 정보 없음';

        document.getElementById('vitaminA').innerText = vitaminA;
        document.getElementById('vitaminB').innerText = vitaminB;
        document.getElementById('vitaminC').innerText = vitaminC;
    }
</script>
</body>
</html>
